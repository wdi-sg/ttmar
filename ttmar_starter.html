<!DOCTYPE html>
<html>
  
<head>
  <meta charset="utf-8">
  <title>Take the money and run</title>
  <style>
    body{
      text-align: center;
    }
  </style>
  <script>
    // I'm going to use global variables here because they're convenient to pass info to callbacks.
    // To protect the global variables from being accessed accidentally, they're prefixed with 2 underscores.
    let __clickCount = 0;
    let __prevColour;
    let __colourResetTimer = null;

    // Need a callback for resetting the background colour after 5 seconds because the delay means that
    // a setTimeout function has to be used. This function will need to null the global variable carrying
    // the timer so that the function calling the timer will know that the previous timer has finished.
    function resetBackgroundColour () {
      document.querySelector('body').style.backgroundColor = __prevColour;
      __colourResetTimer = null
    }

    // Since each colour is represented by a string '#000000' to '#FFFFFF', a random colour can be
    // generated by taking 6 random letters from the string '0123456789ABCDEF' and concatenating them.
    // We also need to store the current background colour in a global variable because that's the only
    // way to pass that info into the callback resetBackgroundColour above. Lastly, we need to check
    // that there isn't already a timer running when we click, otherwise we would end up spamming timers
    // on the page. The solution I've chosen is that if there's an existing timer, we clear it and
    // start a new one in its place.
    function changeBackgroundToRandomColour () {
      __prevColour = document.querySelector('body').style.backgroundColor;
      let hex = '0123456789ABCDEF';
      let colour = '#';
      for (let i = 0; i < 6; i++) {
        colour += hex[Math.floor(Math.random() * 16)];
      };
      document.querySelector('body').style.backgroundColor = colour;
      if (__colourResetTimer != null) {
        clearTimeout(__colourResetTimer);
      }
      __colourResetTimer = setTimeout(resetBackgroundColour, 5000);
      
    }
    
    // This function exists solely to increase the __clickCount global variable, and is written because
    // we want to do something when __clickCount hits 5. Rather than write the same if (...) check
    // for every callback function, we might as well put all that into a function and call it each time
    // we want to increase the value of __clickCount.
    function clickIncrement () {
      __clickCount++;
      if (__clickCount == 5) {
        alert('Five clicks reached');
      }
    }

    // Callback for the button press. Get the value of the input and use the querySelectorAll method
    // to get an array of elements with that as the class name. If that array has 0 length, the user
    // is trolling. Otherwise, loop through those elements and change their display to block.
    function revealElement () {
      let name = document.getElementById('elem-to-reveal').value;
      let elemList = document.querySelectorAll('.' + name);
      if (elemList.length > 0) {
        elemList.forEach(elem => {elem.style.display = 'block'})
      } else {
        alert("You need to give a valid class name!");
      }
    }

    document.addEventListener('DOMContentLoaded', () => {

      let links = document.querySelectorAll('a');
      
      links[0].addEventListener('click', () => {
        document.querySelector('body').style.backgroundColor = 'green';
        clickIncrement();
      });

      // e.target refers to the link that was pressed. parentNode refers to the p element containing it.
      // nextElementSibling refers to the next element sitting directly below it in the HTMl. These 2 links
      // have event listeners declared in a similar way because the stuff after them are contained in a
      // single div. Convenient.
      [links[1], links[2]].forEach(l => {
        l.addEventListener('click', e => {
          clickIncrement();
          changeBackgroundToRandomColour();
          e.target.parentNode.nextElementSibling.style.display = 'block';
        })
      });

      // Less convenient are these next 2, but we can use the first word of the id of the links to
      // query for the class that we want, then loop through the array of elements returned and change
      // their display style to block.
      [links[3], links[4]].forEach((l) => {
        l.addEventListener('click', (e) => {
          clickIncrement();
          changeBackgroundToRandomColour();
          let prefix = e.target.getAttribute('id').split('_')[0];
          document.querySelectorAll('.' + prefix + '_paragraph').forEach((elem) => {
            elem.style.display = 'block';
          })
        })
      });

      // When the last link is clicked, we start a loop from the node below its immediate parent.
      // Each loop checks whether that node has a class of 'second_chorus' and a display style of
      // none. If so, we change its display style to block and then break the loop. Note that the
      // loop also breaks once the next node is no longer of class 'second_chorus' so this will
      // not in fact loop through all the elements in the document.
      links[5].addEventListener('click', e => {
        clickIncrement();
        changeBackgroundToRandomColour();
        let elem = e.target.parentNode.nextElementSibling;
        while (elem.getAttribute('class') == 'second_chorus') {
          if (elem.style.display == 'none') {
            elem.style.display = 'block';
            break;
          };
          elem = elem.nextElementSibling;
        };
      });

      document.getElementById('reveal-button').addEventListener('click', revealElement);
    });
    

  </script>
</head>
<body>
  <input id="elem-to-reveal" type="text" name="elem-to-reveal" /><button id="reveal-button" name="Reveal">Reveal</button>
  <h1>Take the Money and Run</h1>
  <p><a id="first_paragraph" href="#">Click me first!</a></p>
  <div class="first_paragraph" style="color:white">
    This here's a story about Billy Joe and Bobbie Sue<br>
    Two young lovers with nothin' better to do<br>
    Than sit around the house, have fun, and watch the tube<br>
    And here is what happened when they decided to cut loose<br>
  </div>

  <p><a id="second_paragraph" href="#">Click me Second!</a></p>
  <div class="second_paragraph" style="display:none">
    They headed down to, ooh, old El Paso<br>
    That's where they ran into a great big hassle<br>
    Billy Joe shot a man while robbing his castle<br>
    Bobbie Sue took the money and run
  </div>

  <p><a id="first_chorus" href="#">Click me Third!</a></p>
  <div class="first_chorus" style="display:none">
    Go on take the money and run<br>
    Go on take the money and run<br>
    Go on take the money and run<br>
    Go on take the money and run
  </div>

  <p><a id="third_paragraph" href="#">Click me Fourth!</a></p>
  <p class="third_paragraph" style="display:none">Billy Mack is a detective down in Texas</p>
  <p class="third_paragraph" style="display:none">You know he knkows just exactly what the facts is</p>
  <p class="third_paragraph" style="display:none">He ain't gonna let those two escape justice</p>
  <p class="third_paragraph" style="display:none">He makes his livin' off of the people's taxes</p>

  <p><a id="fourth_paragraph" href="#">Click me Fifth!</a></p>
  <p class="fourth_paragraph" style="display:none">Bobbie Sue, whoa, whoa, she slipped away</p>
  <p class="fourth_paragraph" style="display:none">Billy Joe caught up to her the very next day</p>
  <p class="fourth_paragraph" style="display:none">They got the money, hey</p>
  <p class="fourth_paragraph" style="display:none">You know they got away</p>
  <p class="fourth_paragraph" style="display:none">They headed down south and they're still running today</p>
  <p class="fourth_paragraph" style="display:none">Singin' go on take the money and run</p>

  <p><a id="second_chorus" href="#">Click me 6 times!</a></p>
  <p class="second_chorus" style="display:none">Go on take the money and run</p>
  <p class="second_chorus" style="display:none">Go on take the money and run</p>
  <p class="second_chorus" style="display:none">Go on take the money and run</p>
  <p class="second_chorus" style="display:none">Go on take the money and run</p>
  <p class="second_chorus" style="display:none">Go on take the money and run</p>
  <p class="second_chorus" style="display:none">Go on take the money and run</p>


  <script>

  </script>
</body>
</html>
